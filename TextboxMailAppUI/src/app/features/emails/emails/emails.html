<div class="container mt-5">
  <h2 class="mb-4 text-center fw-bold text-primary">E-Posta Listesi</h2>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <!-- Sol: Yenile Butonu -->
    <button class="btn btn-outline-primary rounded-pill px-4" (click)="refreshEmails()">
      <i class="bi bi-arrow-clockwise me-1"></i> Yenile
    </button>

    <!-- Sağ: Arama alanı -->
    <div class="d-flex">
      <input type="text" class="form-control me-2" placeholder="Ara..." [(ngModel)]="searchTerm">
      <button class="btn btn-primary" (click)="onSearch()">
        Ara
      </button>
    </div>
  </div>
  <!-- Yükleniyor göstergesi -->
  @if (isLoading) {
  <div class="text-center py-5">
    <div class="spinner-grow text-primary" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Yükleniyor...</span>
    </div>
    <p class="mt-2 text-muted">E-postalar yükleniyor, lütfen bekleyin...</p>
  </div>
  }

  <!-- Hiç mail yoksa -->
  @if (!isLoading && emails.length === 0) {
  <div class="alert alert-info text-center border-0 shadow-sm" role="alert">
    <i class="bi bi-info-circle me-2"></i>Gösterilecek e-posta bulunmamaktadır.
  </div>
  }

  <!-- Mail tablosu -->
  @if (!isLoading && emails.length > 0) {
  <div class="table-responsive rounded shadow-sm">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-primary">
        <tr>
          <th scope="col">
            <button class="btn btn-sm btn-outline-primary w-100 text-start" (click)="onSort('fromName')">
              Gönderen
            </button>
          </th>
          <th scope="col">
            <button class="btn btn-sm btn-outline-primary w-100 text-start" (click)="onSort('fromAddress')">
              E-Posta Adresi
            </button>
          </th>
          <th scope="col">
            <button class="btn btn-sm btn-outline-primary w-100 text-start" (click)="onSort('subject')">
              Konu
            </button>
          </th>
          <th scope="col">
            <button class="btn btn-sm btn-outline-primary w-100 text-start" (click)="onSort('date')">
              Tarih
            </button>
          </th>
          <th scope="col" class="fw-semibold">İşlem</th>
        </tr>
      </thead>


      <tbody>
        @for (email of emails; track email.id) {
        <tr>
          <td class="text-truncate" style="max-width: 150px;">{{email.fromName}}</td>
          <td class="text-truncate" style="max-width: 200px;">{{email.fromAddress}}</td>
          <td class="text-truncate" style="max-width: 250px;">{{email.subject}}</td>
          <td>{{email.date | date:'dd.MM.yyyy HH:mm'}}</td>
          <td>
            <button class="btn btn-sm btn-outline-primary rounded-pill px-3" (click)="showEmailDetail(email.id)">
              <i class="bi bi-eye me-1"></i> Detay
            </button>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Sayfalama -->
  <div class="d-flex justify-content-between align-items-center mt-4">
    <button class="btn btn-outline-primary rounded-pill px-4" (click)="prevPage()" [disabled]="pageNumber === 1">
      <i class="bi bi-chevron-left me-1"></i> Önceki
    </button>
    <span class="text-muted fw-semibold">Sayfa: {{pageNumber}}</span>
    <button class="btn btn-outline-primary rounded-pill px-4" (click)="nextPage()">
      Sonraki <i class="bi bi-chevron-right ms-1"></i>
    </button>
  </div>
  }
</div>

<!--Mail Detayı-->
<div class="modal fade" [class.show]="isModalOpen" [ngStyle]="{'display': isModalOpen ? 'block' : 'none'}" tabindex="-1"
  role="dialog" aria-labelledby="emailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
    <div class="modal-content border-0 rounded-3 shadow-sm">
      <div class="modal-header bg-light border-bottom table-primary">
        <h5 class="modal-title fw-bold text-primary" id="emailModalLabel">E-Posta Detayları</h5>
        <button type="button" class="btn-close" (click)="closeModal()" aria-label="Kapat"></button>
      </div>

      @if (selectedEmail) {
      <div class="modal-body p-4">
        <div class="email-detail">
          <p class="mb-3"><strong class="text-primary fw-semibold">UID:</strong> {{selectedEmail.uid}}</p>
          <p class="mb-3"><strong class="text-primary fw-semibold">Gönderen:</strong> {{selectedEmail.fromName}} <span
              class="text-muted">({{selectedEmail.fromAddress}})</span></p>
          <p class="mb-3"><strong class="text-primary fw-semibold">Alıcı:</strong> {{selectedEmail.to}}</p>
          <p class="mb-3"><strong class="text-primary fw-semibold">CC:</strong> {{selectedEmail.cc || 'Yok'}}</p>
          <p class="mb-3"><strong class="text-primary fw-semibold">Konu:</strong> {{selectedEmail.subject}}</p>
          <p class="mb-3"><strong class="text-primary fw-semibold">Tarih:</strong> {{selectedEmail.date |
            date:'dd.MM.yyyy HH:mm'}}</p>
          <p class="mb-3"><strong class="text-primary fw-semibold">Özet:</strong> {{selectedEmail.snippet}}</p>
          <hr class="my-3">
          <div>
            <strong class="text-primary fw-semibold">İçerik:</strong>
            <div class="bg-light p-3 rounded-2 mt-2" style="white-space: pre-wrap;">
              {{selectedEmail.body}}
            </div>
          </div>
        </div>
      </div>
      }
      <div class="modal-footer border-top">
        <button type="button" class="btn btn-outline-primary rounded-pill px-4" (click)="closeModal()">Kapat</button>
      </div>
    </div>
  </div>
</div>

